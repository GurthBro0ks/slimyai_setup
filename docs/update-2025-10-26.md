# Update – 2025-10-26: Admin Portal, Snail Tools, Slime Chat

This document captures the end-to-end changes delivered in the October 26 release.

## Authentication & Roles
- Consolidated login to `/api/auth/login`; OAuth callback now fetches guild + role information via the bot token.
- Roles resolved with `ROLE_ADMIN_IDS` and `ROLE_CLUB_IDS`; cookie/JWT include `{id, role, guilds}` for quick checks.
- Post-login redirects by role: `admin → /guilds`, `club → /club`, `member → /snail`.
- Added `docs/auth.md` for environment and role configuration.

## Snail Tools
- Snail analyze accepts up to 8 files (10 MB each), stores per-user results at `data/snail/<guild>/<user>/latest.json`.
- Responses include uploader metadata and public URLs; metrics track images processed.
- Codes endpoint proxies to `SNELP_CODES_URL` with scope filters (`active`, `past7`, `all`) and local fallback.
- UI redesign: drag-and-drop uploads, stats history, codes toggle, help refresh, calc tab, Species War placeholder.
- `docs/snail.md` summarizes workflows and API expectations.

## Settings & Channels
- Guild settings persisted under `data/settings/<guild>.json` with screenshot channel + persona overrides.
- Channel list API returns categories + channels (cached 60 s) and requires guild membership.
- Admin UI uses dropdown selection, one-click screenshot assignment, and persona drawer with canned presets.
- `docs/channels.md` details the schema and UI flow.

## Usage & Diagnostics
- `/api/diag` now exposes uptime, request, image, and chat counters; OpenAI usage probe masks keys and reports connectivity.
- Guild Usage page includes quick metrics + diagnostics card alongside cost charts.
- `docs/usage.md` documents API responses and UI expectations.

## Club Dashboard
- New `/club` route for club roles: guild selector, Snail snapshot tiles, quick link to Snail Tools.
- Members continue to land on Snail Tools; admins retain full dashboard.

## Slime Chat
- Socket.IO server initialized in `src/socket.js`; connections authenticate via `slimy_admin` cookie.
- Clients join `guild:<id>` rooms plus `admins` room; `/api/chat/bot` routes prompts to OpenAI when configured.
- UI at `/chat` now renders a bottom pop-up bar with retro bubbles, guild selector, and a static mention hint instead of the old Ask Bot button.
- `docs/chat.md` explains server/client flows and color map.

## Navigation & Layout
- Sidebar respects role visibility, keeps Email Login pinned for admins, and adds shortcuts for Snail, Club, and Chat.
- Dashboard quick actions promote Corrections, Rescan, and Snail.

## Testing & Metrics
- `admin-api/tests/role-guards.js` asserts member vs admin access to Snail endpoints, guild list, and diag routes.
- Metrics are tracked via `src/lib/metrics.js`; Snail analyze and chat bot increment counters.

For setup and operational notes see the updated README and individual docs referenced above.
