"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{5754:function(e,t,n){n.d(t,{Z:function(){return y}});var r=n(5893),a=n(7294),l=n(9008),i=n.n(l),o=n(1664),s=n.n(o),c=n(1163),d=n(2608),h=n(7751),u=n(6976);let g=e=>(0,h.SC)(e);function m(){var e,t;let{data:n}=(0,u.ZP)("/api/diag",g,{refreshInterval:6e4,revalidateOnFocus:!1}),[l,i]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{n&&i(!0)},[n]),!l||!(null==n?void 0:n.ok))return null;let o=n.admin||{},s=n.uploads||{};return(0,r.jsxs)("div",{style:{padding:"0.9rem 1rem",borderRadius:12,border:"1px solid rgba(148, 163, 184, 0.18)",background:"rgba(12, 17, 29, 0.9)",marginBottom:18,boxShadow:"0 12px 30px rgba(15, 23, 42, 0.35)"},children:[(0,r.jsx)("div",{style:{fontWeight:600,marginBottom:6},children:"Diagnostics"}),(0,r.jsxs)("div",{style:{fontSize:12,opacity:.85},children:["API Uptime: ",(0,r.jsx)("strong",{children:(0,h.Y)(o.uptimeSec)})]}),(0,r.jsxs)("div",{style:{fontSize:12,opacity:.85},children:["Memory: ",(0,r.jsx)("strong",{children:o.memory?"".concat(o.memory.rssMb," MB"):"—"})]}),(0,r.jsxs)("div",{style:{fontSize:12,opacity:.85},children:["Uploads today: ",(0,r.jsx)("strong",{children:null!==(e=s.today)&&void 0!==e?e:0})]}),(0,r.jsxs)("div",{style:{fontSize:12,opacity:.75},children:["Total uploads: ",null!==(t=s.total)&&void 0!==t?t:0]})]})}var f=n(7642);let p=n(3454).env.NEXT_PUBLIC_ADMIN_API_BASE||"";function x(e){let{guildId:t}=e,{user:n}=(0,d.k)(),[l,i]=(0,a.useState)(!1),[o,s]=(0,a.useState)([]),[c,h]=(0,a.useState)(""),[u,g]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),b=(0,a.useRef)(null),y=(0,a.useRef)(null),j=(null==n?void 0:n.role)==="admin",v=j?"(admin)":"",S=j?"admin-global":"guild-".concat(t||"unknown"),C="slimeChatCache:".concat(S);(0,a.useEffect)(()=>{if(n)try{let e=localStorage.getItem(C);if(e){let t=JSON.parse(e);Array.isArray(t)&&(s(t),console.log("[chat-bar] loaded",t.length,"cached messages for",S))}}catch(e){console.warn("[chat-bar] failed to load cache:",e)}},[n,C,S]),(0,a.useEffect)(()=>{if(!n)return;let e=p||window.location.origin;console.log("[chat-bar] connecting to",e);let t=(0,f.io)(e,{withCredentials:!0,transports:["websocket","polling"]});return b.current=t,t.on("connect",()=>{console.log("[chat-bar] connected"),x(!1),g(null)}),t.on("disconnect",e=>{console.log("[chat-bar] disconnected:",e),x(!1),g("Disconnected from chat.")}),t.on("error",e=>{console.error("[chat-bar] socket error:",e),x(!1),g(e.error||e.message||"Connection error")}),t.on("chat:message",e=>{(!e.adminOnly||j)&&s(t=>{let n=[...t,e];try{let e=n.slice(-50);localStorage.setItem(C,JSON.stringify(e))}catch(e){console.warn("[chat-bar] failed to cache messages:",e)}return n})}),t.on("connect_error",e=>{console.error("[chat-bar] connect_error:",e.message),x(!1),g("Failed to connect to chat.")}),()=>{t.disconnect()}},[n,j]),(0,a.useEffect)(()=>{l&&y.current&&y.current.scrollIntoView({behavior:"smooth"})},[o,l]);let k=()=>{if(!c.trim()||!b.current||!t)return;let e={text:c.trim(),guildId:t,adminOnly:!1};b.current.emit("chat:message",e,e=>{(null==e?void 0:e.error)&&g(e.error)}),h("")};return n?(0,r.jsxs)("div",{style:{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,backgroundColor:"#1f2937",borderTop:"1px solid #374151",boxShadow:"0 -2px 10px rgba(0,0,0,0.3)"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 1rem",cursor:"pointer",backgroundColor:"#111827",borderBottom:l?"1px solid #374151":"none"},onClick:()=>i(!l),children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,r.jsx)("span",{style:{color:"#f3f4f6",fontWeight:"600"},children:"Chat"}),v&&(0,r.jsx)("span",{style:{fontSize:"0.75rem",color:"#9ca3af",backgroundColor:"#374151",padding:"0.125rem 0.5rem",borderRadius:"0.25rem"},children:v}),m&&(0,r.jsx)("span",{style:{fontSize:"0.75rem",color:"#fbbf24"},children:"Connecting..."}),u&&(0,r.jsx)("span",{style:{fontSize:"0.75rem",color:"#ef4444"},children:u})]}),(0,r.jsx)("span",{style:{color:"#9ca3af"},children:l?"▼":"▲"})]}),l&&(0,r.jsxs)("div",{style:{height:"40vh",maxHeight:"400px",display:"flex",flexDirection:"column",backgroundColor:"#1f2937"},children:[(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:"0.5rem",display:"flex",flexDirection:"column",gap:"2px",fontSize:"0.8rem",lineHeight:"1.2"},children:[0===o.length&&!u&&!m&&(0,r.jsx)("div",{style:{color:"#9ca3af",textAlign:"center",marginTop:"2rem",fontSize:"0.75rem"},children:"No messages yet. Start chatting!"}),o.map((e,t)=>(0,r.jsxs)("div",{style:{padding:"4px 6px",backgroundColor:e.adminOnly?"#374151":"transparent",borderLeft:"2px solid ".concat(e.from.color),borderRadius:"2px"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"baseline",gap:"0.4rem",marginBottom:"2px"},children:[(0,r.jsx)("span",{style:{color:e.from.color,fontWeight:"600",fontSize:"0.75rem"},children:e.from.name}),(0,r.jsx)("span",{style:{color:"#6b7280",fontSize:"0.65rem"},children:new Date(e.ts).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.adminOnly&&(0,r.jsx)("span",{style:{color:"#ef4444",fontSize:"0.65rem",fontWeight:"600"},children:"[ADMIN]"})]}),(0,r.jsx)("div",{style:{color:"#f3f4f6",fontSize:"0.8rem",whiteSpace:"pre-wrap",lineHeight:"1.3"},children:e.text})]},e.messageId||t)),(0,r.jsx)("div",{ref:y})]}),!u&&(0,r.jsxs)("div",{style:{padding:"0.5rem 0.75rem",borderTop:"1px solid #374151",display:"flex",gap:"0.4rem"},children:[(0,r.jsx)("input",{type:"text",value:c,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},placeholder:t?"Type a message...":"Select a guild first",disabled:!t||m,style:{flex:1,padding:"0.4rem 0.6rem",backgroundColor:"#374151",border:"1px solid #4b5563",borderRadius:"0.25rem",color:"#f3f4f6",fontSize:"0.8rem"}}),(0,r.jsx)("button",{onClick:k,disabled:!c.trim()||!t||m,style:{padding:"0.4rem 0.8rem",backgroundColor:c.trim()&&t&&!m?"#3b82f6":"#4b5563",color:"#f3f4f6",border:"none",borderRadius:"0.25rem",cursor:c.trim()&&t&&!m?"pointer":"not-allowed",fontSize:"0.75rem",fontWeight:"600"},children:"Send"})]})]})]}):null}let b=[{href:e=>"/guilds/".concat(e),label:"Dashboard"},{href:e=>"/guilds/".concat(e,"/settings"),label:"Club Settings"},{href:e=>"/guilds/".concat(e,"/channels"),label:"Channels"},{href:e=>"/guilds/".concat(e,"/personality"),label:"Personality"},{href:e=>"/guilds/".concat(e,"/usage"),label:"Usage"}];function y(e){let{guildId:t,children:n,title:l,hideSidebar:o=!1}=e,u=(0,c.useRouter)(),g=(0,h.h_)(),{user:f,refresh:p}=(0,d.k)(),[y,j]=(0,a.useState)(!1),v=()=>j(!1),S=(null==f?void 0:f.role)||"member",C=(0,a.useMemo)(()=>{if(!t||!(null==f?void 0:f.guilds))return S;let e=f.guilds.find(e=>String(e.id)===String(t));return e&&e.role||S},[null==f?void 0:f.guilds,t,S]),k="admin"===C,w="club"===C&&!k,D=(0,a.useMemo)(()=>u.asPath?u.asPath.split("?")[0]:"",[u.asPath]),P=(0,a.useMemo)(()=>t&&k?b.map(e=>{let n=e.href(t);return{...e,href:n,active:D===n}}):[],[t,D,k]),I=t?"/snail/".concat(t):"/snail",N=(0,a.useMemo)(()=>!!u.asPath&&u.asPath.startsWith("/snail"),[u.asPath]),T=(0,a.useMemo)(()=>!!u.asPath&&u.asPath.startsWith("/email-login"),[u.asPath]),z=(0,a.useMemo)(()=>!!u.asPath&&u.asPath.startsWith("/club"),[u.asPath]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:l||"slimy.ai – Admin Panel"})}),!o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"header",children:[(0,r.jsx)("button",{className:"burger",onClick:()=>j(e=>!e),"aria-label":"Toggle menu",children:"☰"}),(0,r.jsx)("div",{style:{fontWeight:700},children:"slimy.ai Admin"}),(0,r.jsx)("div",{style:{width:40}})]}),(0,r.jsxs)("div",{className:"shell",children:[(0,r.jsxs)("aside",{"data-open":y?"true":"false",children:[(0,r.jsx)("div",{className:"diag card",children:(0,r.jsx)(m,{})}),(0,r.jsxs)("div",{style:{marginBottom:24},children:[(0,r.jsx)("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:"slimy.ai Admin"}),f&&(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6,marginTop:12},children:[(0,r.jsxs)("span",{style:{opacity:.8,fontSize:14},children:[f.username," \xb7 ",C.toUpperCase()]}),(0,r.jsx)("button",{className:"btn outline",onClick:async()=>{try{await g("/api/auth/logout",{method:"POST"}),await p(),u.push("/")}catch(e){console.error(e)}},children:"Logout"})]})]}),(0,r.jsxs)("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:16},children:[k&&t?(0,r.jsx)("nav",{style:{display:"flex",flexDirection:"column",gap:8},children:P.map(e=>(0,r.jsx)(s(),{href:e.href,legacyBehavior:!0,children:(0,r.jsx)("a",{onClick:v,style:{padding:"10px 12px",borderRadius:8,background:e.active?"rgba(56, 189, 248, 0.15)":"transparent",border:e.active?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:e.label})},e.href))}):k?(0,r.jsx)("p",{style:{opacity:.7},children:"Select a guild to begin."}):(0,r.jsx)("p",{style:{opacity:.7},children:"Snail tools let members analyze captures without admin access."}),(0,r.jsxs)("nav",{style:{display:"flex",flexDirection:"column",gap:8},children:[w&&(0,r.jsx)(s(),{href:"/club",legacyBehavior:!0,children:(0,r.jsx)("a",{onClick:v,style:{padding:"10px 12px",borderRadius:8,background:z?"rgba(56, 189, 248, 0.15)":"transparent",border:z?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:"Club Dashboard"})}),(0,r.jsx)(s(),{href:I,legacyBehavior:!0,children:(0,r.jsxs)("a",{onClick:v,style:{padding:"10px 12px",borderRadius:8,display:"inline-flex",alignItems:"center",gap:8,fontWeight:600,background:N?"rgba(56, 189, 248, 0.15)":"transparent",border:N?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:[(0,r.jsx)("span",{role:"img","aria-label":"snail",children:"\uD83D\uDC0C"})," Snail Tools"]})}),(0,r.jsx)(s(),{href:"/chat",legacyBehavior:!0,children:(0,r.jsx)("a",{onClick:v,style:{padding:"10px 12px",borderRadius:8,display:"inline-flex",alignItems:"center",gap:8,fontWeight:600,background:u.asPath.startsWith("/chat")?"rgba(56, 189, 248, 0.15)":"transparent",border:u.asPath.startsWith("/chat")?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:"\uD83D\uDCAC Slime Chat"})}),k&&(0,r.jsx)(s(),{href:"/email-login",legacyBehavior:!0,children:(0,r.jsx)("a",{onClick:v,style:{padding:"10px 12px",borderRadius:8,display:"inline-flex",alignItems:"center",gap:8,fontWeight:600,background:T?"rgba(56, 189, 248, 0.15)":"transparent",border:T?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:"\uD83D\uDCE7 Email Login"})})]})]})]}),(0,r.jsx)("div",{className:"mobile-overlay","data-open":y?"true":"false",onClick:v}),(0,r.jsxs)("main",{className:"content",children:[l&&(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:24},children:l}),n]})]})]}),o&&(0,r.jsxs)("main",{className:"content content--without-sidebar",children:[l&&(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:24},children:l}),n]}),f&&(0,r.jsx)(x,{guildId:t})]})}},7751:function(e,t,n){n.d(t,{SC:function(){return o},Y:function(){return i},h_:function(){return s}});var r=n(7294),a=n(2608);let l=n(3454).env.NEXT_PUBLIC_ADMIN_API_BASE||"";function i(e){let t=Number.isFinite(e)?Math.max(0,Math.floor(e)):Math.max(0,Math.floor(Number(e)||0)),n=Math.floor(t/86400),r=Math.floor(t%86400/3600),a=Math.floor(t%3600/60);return n>0?"".concat(n,"d ").concat(r,"h"):r>0?"".concat(r,"h ").concat(a,"m"):a>0?"".concat(a,"m"):"".concat(t%60,"s")}async function o(e){let{method:t="GET",body:n,csrfToken:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new Headers;!n||n instanceof FormData||a.set("Content-Type","application/json"),r&&t&&"GET"!==t&&a.set("x-csrf-token",r);let i=await fetch("".concat(l).concat(e),{method:t,body:n?n instanceof FormData?n:JSON.stringify(n):void 0,credentials:"include",headers:a});if(204===i.status)return null;let o=(i.headers.get("content-type")||"").includes("application/json")?await i.json():await i.text();if(!i.ok)throw Error((null==o?void 0:o.error)||(null==o?void 0:o.message)||"HTTP ".concat(i.status));return o}function s(){let{csrfToken:e}=(0,a.k)();return(0,r.useCallback)(function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o(t,{...n,csrfToken:e})},[e])}},2608:function(e,t,n){n.d(t,{k:function(){return l}}),n(5893);var r=n(7294);n(3454);let a=(0,r.createContext)({user:null,csrfToken:null,loading:!0,refresh:async()=>{},setCsrfToken:()=>{}});function l(){return(0,r.useContext)(a)}}}]);