(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[721],{7624:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds/[guildId]/usage",function(){return n(2720)}])},4166:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var a=n(4246),s=n(9894),l=n.n(s),r=n(6677),i=n(7378),o=n(6e3),c=n(5682);let d=[{href:e=>"/guilds/".concat(e),label:"Dashboard"},{href:e=>"/guilds/".concat(e,"/settings"),label:"Club Settings"},{href:e=>"/guilds/".concat(e,"/channels"),label:"Channels"},{href:e=>"/guilds/".concat(e,"/personality"),label:"Personality"},{href:e=>"/guilds/".concat(e,"/corrections"),label:"Corrections"},{href:e=>"/guilds/".concat(e,"/rescan"),label:"Rescan User"},{href:e=>"/guilds/".concat(e,"/usage"),label:"Usage"}];function u(e){var t;let{guildId:n,children:s,title:u}=e,h=(0,r.useRouter)(),g=(0,c.h)(),{user:x,refresh:f}=(0,o.k)(),p=(0,i.useMemo)(()=>n?d.map(e=>{let t=e.href(n);return{...e,href:t,active:h.pathname===t}}):[],[n,h.asPath]);return(0,a.jsxs)("div",{className:"layout",children:[(0,a.jsxs)("aside",{className:"sidebar",children:[(0,a.jsxs)("div",{style:{marginBottom:32},children:[(0,a.jsx)("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:"Slimy Admin"}),x&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,a.jsxs)("span",{style:{opacity:.8,fontSize:14},children:[x.username," \xb7 ",null===(t=x.role)||void 0===t?void 0:t.toUpperCase()]}),(0,a.jsx)("button",{className:"btn outline",onClick:async()=>{try{await g("/api/auth/logout",{method:"POST"}),await f()}catch(e){console.error(e)}},children:"Logout"})]})]}),n?(0,a.jsx)("nav",{style:{display:"flex",flexDirection:"column",gap:8},children:p.map(e=>(0,a.jsx)(l(),{href:e.href,legacyBehavior:!0,children:(0,a.jsx)("a",{style:{padding:"10px 12px",borderRadius:8,background:h.asPath===e.href?"rgba(56, 189, 248, 0.15)":"transparent",border:h.asPath===e.href?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:e.label})},e.href))}):(0,a.jsx)("p",{style:{opacity:.7},children:"Select a guild to begin."})]}),(0,a.jsxs)("main",{className:"content",children:[u&&(0,a.jsx)("h2",{style:{marginTop:0,marginBottom:24},children:u}),s]})]})}},5682:function(e,t,n){"use strict";n.d(t,{S:function(){return l},h:function(){return r}});var a=n(7378),s=n(6e3);async function l(e){let{method:t="GET",body:n,csrfToken:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=new Headers;!n||n instanceof FormData||s.set("Content-Type","application/json"),a&&t&&"GET"!==t&&s.set("x-csrf-token",a);let l=await fetch("".concat("http://localhost:3080").concat(e),{method:t,body:n?n instanceof FormData?n:JSON.stringify(n):void 0,credentials:"include",headers:s});if(204===l.status)return null;let r=(l.headers.get("content-type")||"").includes("application/json")?await l.json():await l.text();if(!l.ok)throw Error((null==r?void 0:r.error)||(null==r?void 0:r.message)||"HTTP ".concat(l.status));return r}function r(){let{csrfToken:e}=(0,s.k)();return(0,a.useCallback)(function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l(t,{...n,csrfToken:e})},[e])}},2720:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var a=n(4246),s=n(7378),l=n(6677),r=n(9720),i=n(7365),o=n(5566),c=n(4166),d=n(5682);i.kL.register(i.uw,i.f$,i.ZL,i.u,i.De);let u=e=>(0,d.S)(e),h=[{label:"Today",value:"today"},{label:"7 Days",value:"7d"},{label:"30 Days",value:"30d"},{label:"This Month",value:"this_month"}];function g(){let{guildId:e}=(0,l.useRouter)().query,[t,n]=(0,s.useState)("7d"),{data:i}=(0,r.ZP)(e?"/api/guilds/".concat(e,"/usage?window=").concat(t):null,u),d=i?{labels:i.aggregated.byModel.map(e=>e.model),datasets:[{label:"Cost (USD)",data:i.aggregated.byModel.map(e=>Number(e.cost||0)),backgroundColor:"rgba(56, 189, 248, 0.4)"}]}:null;return(0,a.jsxs)(c.Z,{guildId:e,title:"Usage & Spend",children:[(0,a.jsx)("div",{className:"card",style:{marginBottom:24,display:"flex",gap:12},children:h.map(e=>(0,a.jsx)("button",{className:"btn ".concat(t===e.value?"":"outline"),onClick:()=>n(e.value),children:e.label},e.value))}),i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,a.jsx)("h4",{style:{marginTop:0},children:"Cost by Model"}),d&&(0,a.jsx)(o.$Q,{data:d})]}),(0,a.jsx)("div",{className:"card",style:{overflowX:"auto"},children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Model"}),(0,a.jsx)("th",{children:"Requests"}),(0,a.jsx)("th",{children:"Input Tokens"}),(0,a.jsx)("th",{children:"Output Tokens"}),(0,a.jsx)("th",{children:"Images"}),(0,a.jsx)("th",{children:"Cost"})]})}),(0,a.jsx)("tbody",{children:i.aggregated.byModel.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.model}),(0,a.jsx)("td",{children:e.requests||0}),(0,a.jsx)("td",{children:e.inputTokens||0}),(0,a.jsx)("td",{children:e.outputTokens||0}),(0,a.jsx)("td",{children:e.images||0}),(0,a.jsxs)("td",{children:["$",Number(e.cost||0).toFixed(2)]})]},e.model))})]})})]}):(0,a.jsx)("p",{children:"Loading usageâ€¦"})]})}}},function(e){e.O(0,[106,827,720,322,888,774,179],function(){return e(e.s=7624)}),_N_E=e.O()}]);