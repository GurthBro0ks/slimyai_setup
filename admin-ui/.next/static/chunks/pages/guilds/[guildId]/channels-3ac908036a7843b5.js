(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{2599:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds/[guildId]/channels",function(){return t(6254)}])},4166:function(e,n,t){"use strict";t.d(n,{Z:function(){return h}});var a=t(4246),l=t(9894),s=t.n(l),i=t(6677),r=t(7378),c=t(6e3),o=t(5682);let d=[{href:e=>"/guilds/".concat(e),label:"Dashboard"},{href:e=>"/guilds/".concat(e,"/settings"),label:"Club Settings"},{href:e=>"/guilds/".concat(e,"/channels"),label:"Channels"},{href:e=>"/guilds/".concat(e,"/personality"),label:"Personality"},{href:e=>"/guilds/".concat(e,"/corrections"),label:"Corrections"},{href:e=>"/guilds/".concat(e,"/rescan"),label:"Rescan User"},{href:e=>"/guilds/".concat(e,"/usage"),label:"Usage"}];function h(e){var n;let{guildId:t,children:l,title:h}=e,u=(0,i.useRouter)(),x=(0,o.h)(),{user:m,refresh:f}=(0,c.k)(),g=(0,r.useMemo)(()=>t?d.map(e=>{let n=e.href(t);return{...e,href:n,active:u.pathname===n}}):[],[t,u.asPath]);return(0,a.jsxs)("div",{className:"layout",children:[(0,a.jsxs)("aside",{className:"sidebar",children:[(0,a.jsxs)("div",{style:{marginBottom:32},children:[(0,a.jsx)("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:"Slimy Admin"}),m&&(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,a.jsxs)("span",{style:{opacity:.8,fontSize:14},children:[m.username," \xb7 ",null===(n=m.role)||void 0===n?void 0:n.toUpperCase()]}),(0,a.jsx)("button",{className:"btn outline",onClick:async()=>{try{await x("/api/auth/logout",{method:"POST"}),await f()}catch(e){console.error(e)}},children:"Logout"})]})]}),t?(0,a.jsx)("nav",{style:{display:"flex",flexDirection:"column",gap:8},children:g.map(e=>(0,a.jsx)(s(),{href:e.href,legacyBehavior:!0,children:(0,a.jsx)("a",{style:{padding:"10px 12px",borderRadius:8,background:u.asPath===e.href?"rgba(56, 189, 248, 0.15)":"transparent",border:u.asPath===e.href?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:e.label})},e.href))}):(0,a.jsx)("p",{style:{opacity:.7},children:"Select a guild to begin."})]}),(0,a.jsxs)("main",{className:"content",children:[h&&(0,a.jsx)("h2",{style:{marginTop:0,marginBottom:24},children:h}),l]})]})}},5682:function(e,n,t){"use strict";t.d(n,{S:function(){return s},h:function(){return i}});var a=t(7378),l=t(6e3);async function s(e){let{method:n="GET",body:t,csrfToken:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=new Headers;!t||t instanceof FormData||l.set("Content-Type","application/json"),a&&n&&"GET"!==n&&l.set("x-csrf-token",a);let s=await fetch("".concat("http://localhost:3080").concat(e),{method:n,body:t?t instanceof FormData?t:JSON.stringify(t):void 0,credentials:"include",headers:l});if(204===s.status)return null;let i=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok)throw Error((null==i?void 0:i.error)||(null==i?void 0:i.message)||"HTTP ".concat(s.status));return i}function i(){let{csrfToken:e}=(0,l.k)();return(0,a.useCallback)(function(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(n,{...t,csrfToken:e})},[e])}},6254:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return h}});var a=t(4246),l=t(7378),s=t(6677),i=t(9720),r=t(4166),c=t(5682);let o=e=>(0,c.S)(e);function d(e){return{channelId:e.channelId||e.channel_id||"",channelName:e.channelName||e.channel_name||"",modeText:JSON.stringify(e.modes||{},null,2),allowlistText:(e.allowlist||[]).join(",")}}function h(){let{guildId:e}=(0,s.useRouter)().query,n=(0,c.h)(),{data:t,mutate:h}=(0,i.ZP)(e?"/api/guilds/".concat(e,"/channels"):null,o),[u,x]=(0,l.useState)([]),[m,f]=(0,l.useState)(null);(0,l.useEffect)(()=>{(null==t?void 0:t.channels)&&x(t.channels.map(d))},[t]);let g=(e,n)=>{x(t=>{let a=[...t];return a[e]={...a[e],...n},a})},p=async()=>{f("Savingâ€¦");try{let t=u.filter(e=>e.channelId).map(e=>{let n={};try{n=e.modeText?JSON.parse(e.modeText):{}}catch(n){throw Error("Invalid JSON for modes in channel ".concat(e.channelId))}let t=e.allowlistText?e.allowlistText.split(",").map(e=>e.trim()).filter(Boolean):[];return{channelId:e.channelId,channelName:e.channelName,modes:n,allowlist:t}}),a=await n("/api/guilds/".concat(e,"/channels"),{method:"PUT",body:{channels:t}});await h(a,{revalidate:!1}),f("Saved")}catch(e){f(e.message)}};return(0,a.jsxs)(r.Z,{guildId:e,title:"Channel Modes & Allowlist",children:[(0,a.jsx)("div",{className:"card",style:{marginBottom:24},children:(0,a.jsx)("button",{className:"btn",onClick:()=>{x(e=>[...e,{channelId:"",channelName:"",modeText:"{}",allowlistText:""}])},children:"Add Channel"})}),(0,a.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Channel ID"}),(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Modes JSON"}),(0,a.jsx)("th",{children:"Allowlist"})]})}),(0,a.jsx)("tbody",{children:u.map((e,n)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("input",{className:"input",value:e.channelId,onChange:e=>g(n,{channelId:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("input",{className:"input",value:e.channelName,onChange:e=>g(n,{channelName:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("textarea",{className:"textarea",value:e.modeText,onChange:e=>g(n,{modeText:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("textarea",{className:"textarea",value:e.allowlistText,onChange:e=>g(n,{allowlistText:e.target.value})})})]},n))})]}),(0,a.jsxs)("div",{style:{marginTop:20,display:"flex",gap:12},children:[(0,a.jsx)("button",{className:"btn",onClick:p,children:"Save Changes"}),m&&(0,a.jsx)("span",{children:m})]})]})]})}}},function(e){e.O(0,[827,720,888,774,179],function(){return e(e.s=2599)}),_N_E=e.O()}]);