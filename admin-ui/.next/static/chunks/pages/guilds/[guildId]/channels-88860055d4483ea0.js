(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[171],{513:function(e,n,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds/[guildId]/channels",function(){return l(4120)}])},4120:function(e,n,l){"use strict";l.r(n),l.d(n,{default:function(){return h}});var a=l(5893),t=l(7294),s=l(1163),i=l(6976),r=l(5754),d=l(7751);let o=e=>(0,d.SC)(e);function c(e){return{channelId:e.channelId||e.channel_id||"",channelName:e.channelName||e.channel_name||"",modeText:JSON.stringify(e.modes||{},null,2),allowlistText:(e.allowlist||[]).join(",")}}function h(){let{guildId:e}=(0,s.useRouter)().query,n=(0,d.h_)(),{data:l,mutate:h}=(0,i.ZP)(e?"/api/guilds/".concat(e,"/channels"):null,o),{data:m,mutate:u}=(0,i.ZP)(e?"/api/guilds/".concat(e,"/channels/live"):null,o),[x,g]=(0,t.useState)([]),[p,j]=(0,t.useState)(null);(0,t.useEffect)(()=>{(null==l?void 0:l.channels)&&g(l.channels.map(c))},[l]);let f=(e,n)=>{g(l=>{let a=[...l];return a[e]={...a[e],...n},a})},v=async()=>{j("Savingâ€¦");try{let l=x.filter(e=>e.channelId).map(e=>{let n={};try{n=e.modeText?JSON.parse(e.modeText):{}}catch(n){throw Error("Invalid JSON for modes in channel ".concat(e.channelId))}let l=e.allowlistText?e.allowlistText.split(",").map(e=>e.trim()).filter(Boolean):[];return{channelId:e.channelId,channelName:e.channelName,modes:n,allowlist:l}}),a=await n("/api/guilds/".concat(e,"/channels"),{method:"PUT",body:{channels:l}});await h(a,{revalidate:!1}),j("Saved")}catch(e){j(e.message)}};return(0,a.jsxs)(r.Z,{guildId:e,title:"Channel Modes & Allowlist",children:[(0,a.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[(0,a.jsx)("h3",{style:{margin:0,fontSize:"1.1rem",fontWeight:700},children:"Live Channels from Discord"}),(0,a.jsx)("button",{className:"btn outline",onClick:()=>u(),children:"Refresh"})]}),(null==m?void 0:m.note)==="bot_token_missing"&&(0,a.jsx)("div",{style:{padding:"0.75rem",background:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)",borderRadius:"8px",marginBottom:"1rem",color:"rgb(251, 191, 36)"},children:"Bot token not configured on API. Cannot fetch live channels."}),(null==m?void 0:m.error)&&(0,a.jsx)("div",{style:{padding:"0.75rem",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",marginBottom:"1rem",color:"rgb(239, 68, 68)"},children:"Error fetching channels from Discord"}),(null==m?void 0:m.channels)&&m.channels.length>0?(0,a.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))",gap:"0.75rem"},children:m.channels.map(e=>(0,a.jsxs)("div",{style:{padding:"0.6rem 0.8rem",border:"1px solid rgba(255,255,255,.1)",borderRadius:"8px",background:"rgba(255,255,255,.02)"},children:[(0,a.jsx)("div",{style:{fontWeight:600,marginBottom:"0.25rem"},children:e.name}),(0,a.jsx)("div",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace"},children:e.id})]},e.id))}):!m&&(0,a.jsx)("div",{children:"Loading..."})]}),(0,a.jsx)("div",{className:"card",style:{marginBottom:24},children:(0,a.jsx)("button",{className:"btn",onClick:()=>{g(e=>[...e,{channelId:"",channelName:"",modeText:"{}",allowlistText:""}])},children:"Add Channel Configuration"})}),(0,a.jsxs)("div",{className:"card",style:{overflowX:"auto"},children:[(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Channel ID"}),(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Modes JSON"}),(0,a.jsx)("th",{children:"Allowlist"})]})}),(0,a.jsx)("tbody",{children:x.map((e,n)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("input",{className:"input",value:e.channelId,onChange:e=>f(n,{channelId:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("input",{className:"input",value:e.channelName,onChange:e=>f(n,{channelName:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("textarea",{className:"textarea",value:e.modeText,onChange:e=>f(n,{modeText:e.target.value})})}),(0,a.jsx)("td",{children:(0,a.jsx)("textarea",{className:"textarea",value:e.allowlistText,onChange:e=>f(n,{allowlistText:e.target.value})})})]},n))})]}),(0,a.jsxs)("div",{style:{marginTop:20,display:"flex",gap:12},children:[(0,a.jsx)("button",{className:"btn",onClick:v,children:"Save Changes"}),p&&(0,a.jsx)("span",{children:p})]})]})]})}}},function(e){e.O(0,[359,754,888,774,179],function(){return e(e.s=513)}),_N_E=e.O()}]);