(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{9239:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds/[guildId]/corrections",function(){return a(72)}])},4166:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var n=a(4246),l=a(9894),s=a.n(l),i=a(6677),r=a(7378),c=a(6e3),o=a(5682);let d=[{href:e=>"/guilds/".concat(e),label:"Dashboard"},{href:e=>"/guilds/".concat(e,"/settings"),label:"Club Settings"},{href:e=>"/guilds/".concat(e,"/channels"),label:"Channels"},{href:e=>"/guilds/".concat(e,"/personality"),label:"Personality"},{href:e=>"/guilds/".concat(e,"/corrections"),label:"Corrections"},{href:e=>"/guilds/".concat(e,"/rescan"),label:"Rescan User"},{href:e=>"/guilds/".concat(e,"/usage"),label:"Usage"}];function u(e){var t;let{guildId:a,children:l,title:u}=e,h=(0,i.useRouter)(),m=(0,o.h)(),{user:p,refresh:g}=(0,c.k)(),x=(0,r.useMemo)(()=>a?d.map(e=>{let t=e.href(a);return{...e,href:t,active:h.pathname===t}}):[],[a,h.asPath]);return(0,n.jsxs)("div",{className:"layout",children:[(0,n.jsxs)("aside",{className:"sidebar",children:[(0,n.jsxs)("div",{style:{marginBottom:32},children:[(0,n.jsx)("h1",{style:{margin:0,fontSize:22,fontWeight:700},children:"Slimy Admin"}),p&&(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:6},children:[(0,n.jsxs)("span",{style:{opacity:.8,fontSize:14},children:[p.username," \xb7 ",null===(t=p.role)||void 0===t?void 0:t.toUpperCase()]}),(0,n.jsx)("button",{className:"btn outline",onClick:async()=>{try{await m("/api/auth/logout",{method:"POST"}),await g()}catch(e){console.error(e)}},children:"Logout"})]})]}),a?(0,n.jsx)("nav",{style:{display:"flex",flexDirection:"column",gap:8},children:x.map(e=>(0,n.jsx)(s(),{href:e.href,legacyBehavior:!0,children:(0,n.jsx)("a",{style:{padding:"10px 12px",borderRadius:8,background:h.asPath===e.href?"rgba(56, 189, 248, 0.15)":"transparent",border:h.asPath===e.href?"1px solid rgba(56, 189, 248, 0.4)":"1px solid transparent"},children:e.label})},e.href))}):(0,n.jsx)("p",{style:{opacity:.7},children:"Select a guild to begin."})]}),(0,n.jsxs)("main",{className:"content",children:[u&&(0,n.jsx)("h2",{style:{marginTop:0,marginBottom:24},children:u}),l]})]})}},5682:function(e,t,a){"use strict";a.d(t,{S:function(){return s},h:function(){return i}});var n=a(7378),l=a(6e3);async function s(e){let{method:t="GET",body:a,csrfToken:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=new Headers;!a||a instanceof FormData||l.set("Content-Type","application/json"),n&&t&&"GET"!==t&&l.set("x-csrf-token",n);let s=await fetch("".concat("http://localhost:3080").concat(e),{method:t,body:a?a instanceof FormData?a:JSON.stringify(a):void 0,credentials:"include",headers:l});if(204===s.status)return null;let i=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok)throw Error((null==i?void 0:i.error)||(null==i?void 0:i.message)||"HTTP ".concat(s.status));return i}function i(){let{csrfToken:e}=(0,l.k)();return(0,n.useCallback)(function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(t,{...a,csrfToken:e})},[e])}},72:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var n=a(4246),l=a(7378),s=a(6677),i=a(9720),r=a(4166),c=a(5682);let o=e=>(0,c.S)(e);function d(){let{guildId:e}=(0,s.useRouter)().query,t=(0,c.h)(),{data:a,mutate:d}=(0,i.ZP)(e?"/api/guilds/".concat(e,"/corrections"):null,o),[u,h]=(0,l.useState)({displayName:"",metric:"total",value:"",reason:""}),[m,p]=(0,l.useState)(null),[g,x]=(0,l.useState)(""),f=(0,l.useMemo)(()=>(function(e){if(null==e)return null;let t=String(e).trim();if(!t)return null;let a=t.match(/^([\d,.]+)([kmb])$/i);if(a){let e=Number(a[1].replace(/,/g,"")),t=a[2].toLowerCase();return Number.isFinite(e)?e*("k"===t?1e3:"m"===t?1e6:1e9):null}let n=Number(t.replace(/,/g,""));return Number.isFinite(n)?n:null})(u.value),[u.value]),j=async a=>{a.preventDefault(),p("Saving…");try{await t("/api/guilds/".concat(e,"/corrections"),{method:"POST",body:u}),h({displayName:"",metric:u.metric,value:"",reason:""}),await d(),p("Added correction")}catch(e){p(e.message)}},y=async a=>{await t("/api/guilds/".concat(e,"/corrections/").concat(a),{method:"DELETE"}),await d()},v=async()=>{let a=g.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(a.length){for(let n of a){let[a,l,s,i]=n.split(",").map(e=>e.trim());if(a&&l&&s)try{await t("/api/guilds/".concat(e,"/corrections"),{method:"POST",body:{displayName:a,metric:l,value:s,reason:i}})}catch(e){p("Failed to import ".concat(a,": ").concat(e.message));break}}await d(),x(""),p("CSV import complete")}};return(0,n.jsxs)(r.Z,{guildId:e,title:"Member Corrections",children:[(0,n.jsx)("div",{className:"card",style:{marginBottom:24},children:(0,n.jsxs)("form",{onSubmit:j,style:{display:"grid",gap:12},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,n.jsx)("input",{className:"input",placeholder:"Display Name",value:u.displayName,onChange:e=>h(t=>({...t,displayName:e.target.value}))}),(0,n.jsxs)("select",{className:"select",value:u.metric,onChange:e=>h(t=>({...t,metric:e.target.value})),children:[(0,n.jsx)("option",{value:"total",children:"Total"}),(0,n.jsx)("option",{value:"sim",children:"Sim"})]}),(0,n.jsx)("input",{className:"input",placeholder:"Value",value:u.value,onChange:e=>h(t=>({...t,value:e.target.value}))})]}),(0,n.jsx)("input",{className:"input",placeholder:"Reason (optional)",value:u.reason,onChange:e=>h(t=>({...t,reason:e.target.value}))}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,n.jsx)("button",{className:"btn",type:"submit",children:"Add Correction"}),(0,n.jsxs)("span",{style:{opacity:.7},children:["Preview: ",null!=f?f:"—"]}),m&&(0,n.jsx)("span",{children:m})]})]})}),(0,n.jsxs)("div",{className:"card",style:{marginBottom:24},children:[(0,n.jsx)("h4",{style:{marginTop:0},children:"Batch CSV Import"}),(0,n.jsx)("textarea",{className:"textarea",placeholder:"displayName,metric,value,reason",value:g,onChange:e=>x(e.target.value)}),(0,n.jsx)("button",{className:"btn outline",style:{marginTop:12},onClick:v,children:"Import CSV"})]}),(0,n.jsx)("div",{className:"card",style:{overflowX:"auto"},children:(0,n.jsxs)("table",{className:"table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Member"}),(0,n.jsx)("th",{children:"Metric"}),(0,n.jsx)("th",{children:"Value"}),(0,n.jsx)("th",{children:"Reason"}),(0,n.jsx)("th",{children:"Source"}),(0,n.jsx)("th",{children:"Created"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:((null==a?void 0:a.corrections)||[]).map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.display_name}),(0,n.jsx)("td",{children:e.metric}),(0,n.jsx)("td",{children:Number(e.value).toLocaleString()}),(0,n.jsx)("td",{children:e.reason||"—"}),(0,n.jsx)("td",{children:e.source||"manual"}),(0,n.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{className:"btn outline",onClick:()=>y(e.id),children:"Delete"})})]},e.id))})]})})]})}}},function(e){e.O(0,[827,720,888,774,179],function(){return e(e.s=9239)}),_N_E=e.O()}]);