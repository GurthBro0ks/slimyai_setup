(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{7096:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/guilds/[guildId]/corrections",function(){return a(2657)}])},9087:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var l=a(5893),n=a(7294),r=a(6976),i=a(7751);let s=e=>(0,i.SC)(e);function c(e){let{guildId:t}=e,a=(0,i.h_)(),{data:c,mutate:o}=(0,r.ZP)(t?"/api/guilds/".concat(t,"/corrections"):null,s),[d,u]=(0,n.useState)({displayName:"",metric:"total",value:"",reason:""}),[h,m]=(0,n.useState)(null),[p,x]=(0,n.useState)(""),j=(0,n.useMemo)(()=>(function(e){if(null==e)return null;let t=String(e).trim();if(!t)return null;let a=t.match(/^([\d,.]+)([kmb])$/i);if(a){let e=Number(a[1].replace(/,/g,"")),t=a[2].toLowerCase();return Number.isFinite(e)?e*("k"===t?1e3:"m"===t?1e6:1e9):null}let l=Number(t.replace(/,/g,""));return Number.isFinite(l)?l:null})(d.value),[d.value]),g=async e=>{e.preventDefault(),m("Saving…");try{await a("/api/guilds/".concat(t,"/corrections"),{method:"POST",body:d}),u({displayName:"",metric:d.metric,value:"",reason:""}),await o(),m("Added correction")}catch(e){m(e.message)}},y=async e=>{try{await a("/api/guilds/".concat(t,"/corrections/").concat(e),{method:"DELETE"}),await o()}catch(e){m(e.message)}},v=async()=>{let e=p.split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(e.length){for(let l of e){let[e,n,r,i]=l.split(",").map(e=>e.trim());if(e&&n&&r)try{await a("/api/guilds/".concat(t,"/corrections"),{method:"POST",body:{displayName:e,metric:n,value:r,reason:i}})}catch(t){m("Failed to import ".concat(e,": ").concat(t.message));return}}await o(),x(""),m("CSV import complete")}};return(0,l.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,l.jsx)("div",{className:"card",children:(0,l.jsxs)("form",{onSubmit:g,style:{display:"grid",gap:12},children:[(0,l.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[(0,l.jsx)("input",{className:"input",placeholder:"Display Name",value:d.displayName,onChange:e=>u(t=>({...t,displayName:e.target.value}))}),(0,l.jsxs)("select",{className:"select",value:d.metric,onChange:e=>u(t=>({...t,metric:e.target.value})),children:[(0,l.jsx)("option",{value:"total",children:"Total"}),(0,l.jsx)("option",{value:"sim",children:"Sim"})]}),(0,l.jsx)("input",{className:"input",placeholder:"Value",value:d.value,onChange:e=>u(t=>({...t,value:e.target.value}))})]}),(0,l.jsx)("input",{className:"input",placeholder:"Reason (optional)",value:d.reason,onChange:e=>u(t=>({...t,reason:e.target.value}))}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,l.jsx)("button",{className:"btn",type:"submit",children:"Add Correction"}),(0,l.jsxs)("span",{style:{opacity:.7},children:["Preview: ",null!=j?j:"—"]}),h&&(0,l.jsx)("span",{children:h})]})]})}),(0,l.jsxs)("div",{className:"card",children:[(0,l.jsx)("h4",{style:{marginTop:0},children:"Batch CSV Import"}),(0,l.jsx)("textarea",{className:"textarea",placeholder:"displayName,metric,value,reason",value:p,onChange:e=>x(e.target.value)}),(0,l.jsx)("button",{className:"btn outline",style:{marginTop:12},onClick:v,children:"Import CSV"})]}),(0,l.jsx)("div",{className:"card",style:{overflowX:"auto"},children:(0,l.jsxs)("table",{className:"table",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Member"}),(0,l.jsx)("th",{children:"Metric"}),(0,l.jsx)("th",{children:"Value"}),(0,l.jsx)("th",{children:"Reason"}),(0,l.jsx)("th",{children:"Source"}),(0,l.jsx)("th",{children:"Created"}),(0,l.jsx)("th",{})]})}),(0,l.jsx)("tbody",{children:((null==c?void 0:c.corrections)||[]).map(e=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{children:e.display_name}),(0,l.jsx)("td",{children:e.metric}),(0,l.jsx)("td",{children:Number(e.value).toLocaleString()}),(0,l.jsx)("td",{children:e.reason||"—"}),(0,l.jsx)("td",{children:e.source||"manual"}),(0,l.jsx)("td",{children:new Date(e.created_at).toLocaleString()}),(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"btn outline",type:"button",onClick:()=>y(e.id),children:"Delete"})})]},e.id))})]})})]})}},2657:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return s}});var l=a(5893),n=a(1163),r=a(5754),i=a(9087);function s(){let e=function(e){if(e)return Array.isArray(e)?e[0]:e}((0,n.useRouter)().query.guildId);return(0,l.jsxs)(r.Z,{guildId:e,title:"Member Corrections",children:[(0,l.jsxs)("p",{style:{marginBottom:18,opacity:.75},children:["Corrections now live in the dashboard's ",(0,l.jsx)("strong",{children:"Current Sheet"})," tab. You can continue to manage them here as well."]}),(0,l.jsx)(i.Z,{guildId:e})]})}}},function(e){e.O(0,[359,754,888,774,179],function(){return e(e.s=7096)}),_N_E=e.O()}]);