(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{813:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return t(5640)}])},5640:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return m}});var n=t(5893),l=t(7294),r=t(5754),s=t(2608),a=t(7642);let d=null;function o(){return d||(d=(0,a.io)("https://admin.slimyai.xyz",{withCredentials:!0,transports:["websocket"]})),d}var c=t(1163);let u={member:"#3b82f6",club:"#f59e0b",admin:"#ef4444",bot:"#22c55e"};function m(){let{user:e,loading:i}=(0,s.k)(),t=(0,c.useRouter)(),[a,m]=(0,l.useState)(""),[h,f]=(0,l.useState)([]),[p,x]=(0,l.useState)(""),[v,y]=(0,l.useState)(!0),[b,j]=(0,l.useState)(""),[S,w]=(0,l.useState)(!1),k=(0,l.useRef)(null),C=(null==e?void 0:e.role)==="admin";(0,l.useEffect)(()=>{var t;!i&&e&&(null===(t=e.guilds)||void 0===t?void 0:t.length)&&!a&&m(String(e.guilds[0].id))},[i,e,a]),(0,l.useEffect)(()=>{var n;i||!e||"member"!==e.role||(null===(n=e.guilds)||void 0===n?void 0:n.length)||t.replace("/snail")},[i,e,t]),(0,l.useEffect)(()=>{let e=o(),i=e=>{a&&e.guildId!==a||f(i=>{if(e.messageId){let t=i.findIndex(i=>i.messageId===e.messageId);if(-1!==t){let n=[...i];return n[t]={...n[t],...e,pending:!1},n}}return[...i,e]})};return e.on("chat:message",i),()=>{e.off("chat:message",i)}},[a]),(0,l.useEffect)(()=>()=>void(d&&(d.disconnect(),d=null)),[]),(0,l.useEffect)(()=>{k.current&&requestAnimationFrame(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)})},[h]);let I=(0,l.useCallback)(()=>{if(!a||!p.trim())return;let i=p.trim();x(""),j("");let t=o(),n="".concat(Date.now().toString(36),"-").concat(Math.random().toString(36).slice(2,6)),l=(null==e?void 0:e.role)||"member",r={guildId:a,text:i,ts:new Date().toISOString(),pending:!0,messageId:n,adminOnly:S,from:{id:(null==e?void 0:e.id)||"me",name:(null==e?void 0:e.globalName)||(null==e?void 0:e.username)||"You",role:l,color:u[l]||u.member}};f(e=>[...e,r]);let s=/@slimy(\.ai)?/i.test(i);t.emit("chat:message",{guildId:a,text:i,messageId:n,requestBot:s,adminOnly:S},e=>{e&&e.error&&(j(e.error),f(i=>i.map(i=>i.messageId===n?{...i,pending:!1,error:e.error}:i)))})},[a,p,e,S]);return((0,l.useMemo)(()=>{var i;let t=null==e?void 0:null===(i=e.guilds)||void 0===i?void 0:i.find(e=>String(e.id)===String(a));return t?t.name:"Chat"},[e,a]),i)?(0,n.jsx)(r.Z,{title:"Slime Chat",children:(0,n.jsx)("div",{className:"card",style:{padding:"1.25rem"},children:"Loading…"})}):(0,n.jsx)(r.Z,{title:"Slime Chat",children:(0,n.jsxs)("div",{style:{maxWidth:900,margin:"0 auto",width:"100%",display:"grid",gap:"0.75rem",minHeight:"calc(100vh - 200px)"},children:[(0,n.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,n.jsx)("button",{className:"btn outline",onClick:()=>y(e=>!e),style:{padding:"0.35rem 0.9rem"},children:v?"Hide chat":"Show chat"})}),v&&(0,n.jsxs)("div",{className:"card",style:{display:"flex",flexDirection:"column",gap:"0.75rem",flex:1,minHeight:"60vh"},children:[(0,n.jsxs)("header",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{style:{margin:0},children:"Slime Chat"}),(0,n.jsxs)("div",{style:{opacity:.7,fontSize:"0.9rem"},children:["Connected as ",(null==e?void 0:e.globalName)||(null==e?void 0:e.username)]})]}),(0,n.jsx)("select",{className:"select",value:a,onChange:e=>m(e.target.value),children:((null==e?void 0:e.guilds)||[]).map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,n.jsxs)("div",{ref:k,style:{flex:1,overflowY:"auto",border:"1px solid rgba(148,163,184,0.2)",borderRadius:12,padding:"1rem",background:"rgba(12,18,32,0.75)",display:"flex",flexDirection:"column",gap:"0.75rem",minHeight:0},children:[h.filter(e=>e.guildId===a||!e.guildId).map((i,t)=>{var l;return(0,n.jsx)(g,{message:i,mine:(null===(l=i.from)||void 0===l?void 0:l.id)===(null==e?void 0:e.id)},i.messageId||"".concat(i.ts,"-").concat(t))}),0===h.length&&(0,n.jsx)("div",{style:{opacity:.6,textAlign:"center"},children:"No messages yet. Say hi!"})]}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[(0,n.jsxs)("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[(0,n.jsx)("input",{className:"input",value:p,onChange:e=>x(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),I())},placeholder:"Type a message…"}),(0,n.jsx)("button",{className:"btn",onClick:I,disabled:!p.trim(),children:"Send"})]}),C&&(0,n.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",opacity:.8,cursor:"pointer"},children:[(0,n.jsx)("input",{type:"checkbox",checked:S,onChange:e=>w(e.target.checked),style:{cursor:"pointer"}}),(0,n.jsx)("span",{children:"Admin Only (visible only to admins)"})]})]}),b&&(0,n.jsx)("div",{style:{color:"#f87171",fontSize:"0.85rem"},children:b}),(0,n.jsxs)("footer",{style:{fontSize:"0.85rem",opacity:.7,textAlign:"center"},children:["mention ",(0,n.jsx)("strong",{children:"@slimy.ai"})," to chat with it"]})]})]})})}function g(e){var i,t;let{message:l,mine:r}=e,s=(null==l?void 0:null===(i=l.from)||void 0===i?void 0:i.color)||(r?"#3b82f6":"#f59e0b"),a=!!l.adminOnly;return(0,n.jsxs)("div",{style:{justifySelf:r?"end":"start",maxWidth:"75%",background:a?"rgba(239,68,68,0.15)":r?"rgba(59,130,246,0.15)":"rgba(245,158,11,0.15)",border:a?"2px solid #ef4444":"1px solid ".concat(s,"33"),borderRadius:12,padding:"0.75rem",boxShadow:a?"0 8px 24px rgba(239,68,68,0.3)":"0 8px 24px ".concat(s,"22"),opacity:l.pending?.7:1},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(0,n.jsx)("div",{style:{fontWeight:600,color:s},children:(null===(t=l.from)||void 0===t?void 0:t.name)||"User"}),a&&(0,n.jsx)("span",{style:{fontSize:"0.7rem",padding:"0.125rem 0.375rem",borderRadius:4,background:"#ef4444",color:"white",fontWeight:700},children:"ADMIN"})]}),(0,n.jsx)("div",{style:{whiteSpace:"pre-wrap",lineHeight:1.4},children:l.text}),(0,n.jsx)("div",{style:{fontSize:"0.75rem",opacity:.6,marginTop:6},children:function(e){try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){return"--:--"}}(l.ts)}),l.error&&(0,n.jsx)("div",{style:{fontSize:"0.75rem",color:"#f87171",marginTop:6},children:l.error})]})}}},function(e){e.O(0,[359,754,888,774,179],function(){return e(e.s=813)}),_N_E=e.O()}]);