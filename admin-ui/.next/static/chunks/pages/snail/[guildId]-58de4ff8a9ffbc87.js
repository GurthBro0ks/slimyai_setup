(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[682],{4212:function(e,l,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/snail/[guildId]",function(){return s(7801)}])},7801:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return u}});var a=s(5893),t=s(7294),i=s(1163),n=s(5754),r=s(7751),d=s(2608);let c=[{key:"analyze",label:"Analyze"},{key:"stats",label:"Stats"},{key:"codes",label:"Codes"},{key:"help",label:"Help"},{key:"calc",label:"Calc"},{key:"guides",label:"Snail Guides"},{key:"war",label:"Species War"}],o=[{value:"active",label:"Active"},{value:"past7",label:"Past 7 Days"},{value:"all",label:"All"}];function u(){let e=(0,i.useRouter)(),{user:l,loading:s}=(0,d.k)(),r=e.query.guildId,o=(0,t.useMemo)(()=>r?Array.isArray(r)?r[0]:r:null,[r]),[u,m]=(0,t.useState)("analyze"),[h,b]=(0,t.useState)(0);(0,t.useEffect)(()=>{s||l||e.replace("/")},[s,l,e]);let S=(0,t.useMemo)(()=>!!o&&null!=l&&!!l.guilds&&l.guilds.some(e=>String(e.id)===String(o)),[o,null==l?void 0:l.guilds]),k=(0,t.useMemo)(()=>{if(!o||!(null==l?void 0:l.guilds))return o;let e=l.guilds.find(e=>String(e.id)===String(o));return e?e.name:o},[o,null==l?void 0:l.guilds]);return s||!o?(0,a.jsx)(n.Z,{title:"Snail Tools",children:(0,a.jsx)("div",{className:"card",style:{padding:"1.25rem"},children:"Loading…"})}):S?(0,a.jsxs)(n.Z,{guildId:o,title:"Snail Tools \xb7 ".concat(k||""),children:[(0,a.jsx)("div",{className:"card",style:{marginBottom:"1rem"},children:(0,a.jsx)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:c.map(e=>(0,a.jsx)("button",{className:"btn ".concat(u===e.key?"":"outline"),onClick:()=>m(e.key),style:{minWidth:"110px"},children:e.label},e.key))})}),"analyze"===u&&(0,a.jsx)(p,{guildId:o,onComplete:()=>b(e=>e+1)}),"stats"===u&&(0,a.jsx)(y,{guildId:o,version:h}),"codes"===u&&(0,a.jsx)(g,{guildId:o}),"help"===u&&(0,a.jsx)(x,{guildId:o}),"calc"===u&&(0,a.jsx)(j,{guildId:o}),"guides"===u&&(0,a.jsx)(f,{}),"war"===u&&(0,a.jsx)(v,{})]}):(0,a.jsx)(n.Z,{title:"Snail Tools",children:(0,a.jsxs)("div",{className:"card",style:{padding:"1.25rem"},children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"Access denied"}),(0,a.jsx)("p",{style:{margin:0,opacity:.8},children:"You need to be a member of this guild to use Snail Mode. Pick another guild from the list or ask an admin to link you."})]})})}function p(e){let{guildId:l,onComplete:s}=e,[i,n]=(0,t.useState)([]),[r,d]=(0,t.useState)(""),[c,o]=(0,t.useState)(""),[u,p]=(0,t.useState)(null),[h,y]=(0,t.useState)([]),[g,x]=(0,t.useState)(!1),j=(0,t.useCallback)(e=>{n(Array.from(e.target.files||[]).slice(0,8))},[]),f=(0,t.useCallback)(e=>{e.preventDefault();let l=Array.from(e.dataTransfer.files||[]).filter(e=>e.type.startsWith("image/"));l.length&&n(l.slice(0,8))},[]),v=(0,t.useCallback)(async()=>{p(null),o("Analyzing…"),y([]);try{let e=new FormData;i.forEach(l=>e.append("images",l)),e.append("prompt",r);let a=await fetch("/api/guilds/".concat(l,"/snail/analyze"),{method:"POST",credentials:"include",body:e}),t=await a.json();if(!a.ok)throw Error((null==t?void 0:t.error)||"Failed to analyze");y(t.results||[]),o("Analysis complete"),n([]),"function"==typeof s&&s()}catch(e){p(e.message||"Something went wrong"),o("")}},[i,r,l,s]);return(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:"1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"0.75rem",flexWrap:"wrap"},children:[(0,a.jsx)("h3",{style:{margin:0},children:"Analyze Screenshots"}),(0,a.jsx)("button",{type:"button",className:"btn outline",onClick:()=>x(e=>!e),"aria-expanded":g,children:g?"Hide Help":"Help"})]}),g&&(0,a.jsxs)("div",{"data-testid":"snail-help-panel",style:{border:"1px solid rgba(255,255,255,.12)",borderRadius:12,background:"rgba(15,23,42,0.35)",padding:"0.85rem 1rem"},children:[(0,a.jsxs)("ul",{style:{margin:"0 0 0.75rem",paddingLeft:"1.2rem"},children:[(0,a.jsxs)("li",{children:["Upload up to ",(0,a.jsx)("strong",{children:"8 screenshots"})," (PNG/JPG), each ≤ ",(0,a.jsx)("strong",{children:"10\xa0MB"}),"."]}),(0,a.jsxs)("li",{children:["Include the key views: ",(0,a.jsx)("strong",{children:"Home, Lab, Team, Familiar, Gear"})," (or your guild’s required set)."]}),(0,a.jsxs)("li",{children:["Add an optional prompt like ",(0,a.jsx)("em",{children:"“compare rush vs baseline”"})," to drive a targeted summary."]}),(0,a.jsxs)("li",{children:["Results save per-user at ",(0,a.jsx)("code",{children:"data/snail/<guildId>/<userId>/latest.json"}),"."]}),(0,a.jsx)("li",{children:"Codes sync from Snail’s source automatically; no manual copy/paste needed."})]}),(0,a.jsx)("p",{style:{margin:0,opacity:.75},children:"Tip: keep screenshots uncropped at 100% zoom for best OCR quality. If parsing fails, re-upload clean captures."})]}),(0,a.jsxs)("div",{onDragOver:e=>e.preventDefault(),onDrop:f,style:{border:"1px dashed rgba(148,163,184,0.4)",borderRadius:12,padding:"1.5rem",textAlign:"center",background:"rgba(15,23,42,0.45)"},children:[(0,a.jsx)("p",{style:{margin:"0 0 0.5rem"},children:"Drag screenshots here or pick files:"}),(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:j}),i.length>0&&(0,a.jsx)("ul",{style:{marginTop:"0.75rem",textAlign:"left",fontSize:"0.85rem",opacity:.85},children:i.map(e=>(0,a.jsxs)("li",{children:[e.name,(0,a.jsxs)("span",{style:{opacity:.6},children:[" (",Math.round(e.size/1024)," kB)"]})]},e.name))})]}),(0,a.jsx)("textarea",{className:"textarea",rows:3,placeholder:"Optional prompt (e.g. “compare rush vs baseline”)",value:r,onChange:e=>d(e.target.value)}),(0,a.jsxs)("div",{style:{display:"flex",gap:"0.75rem",alignItems:"center"},children:[(0,a.jsx)("button",{className:"btn",onClick:v,disabled:!i.length,children:"Run analysis"}),c&&(0,a.jsx)("span",{style:{opacity:.8},children:c}),u&&(0,a.jsx)("span",{style:{color:"#f87171"},children:u})]}),h.length>0&&(0,a.jsx)("div",{className:"grid",style:{gap:"1rem"},children:h.map((e,l)=>{var s;return(0,a.jsx)(m,{result:e},"".concat((null===(s=e.file)||void 0===s?void 0:s.storedAs)||l))})})]})}function m(e){var l,s,t,i;let{result:n}=e,r=(null==n?void 0:null===(l=n.analysis)||void 0===l?void 0:l.stats)||{};return(0,a.jsxs)("div",{className:"card",style:{overflow:"hidden"},children:[(null==n?void 0:null===(s=n.file)||void 0===s?void 0:s.url)&&(0,a.jsx)("img",{src:n.file.url,alt:n.file.name,style:{width:"100%",borderRadius:10,marginBottom:12,maxHeight:260,objectFit:"cover"}}),(0,a.jsxs)("div",{style:{fontSize:"0.85rem",opacity:.75,marginBottom:6},children:["Uploaded by ",(null==n?void 0:null===(t=n.uploadedBy)||void 0===t?void 0:t.name)||"unknown"]}),(0,a.jsxs)("div",{style:{display:"grid",gap:6},children:[(0,a.jsx)(h,{title:"Primary",keys:["hp","atk","def","rush"],stats:r}),(0,a.jsx)(h,{title:"Pentagon",keys:["fame","tech","art","civ","fth"],stats:r}),(null==n?void 0:null===(i=n.analysis)||void 0===i?void 0:i.notes)&&(0,a.jsxs)("div",{style:{fontSize:"0.85rem",opacity:.75},children:["Notes: ",n.analysis.notes]})]})]})}function h(e){let{title:l,keys:s,stats:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:600,marginBottom:4},children:l}),(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.75rem",fontSize:"0.9rem"},children:s.map(e=>(0,a.jsxs)("span",{children:[e.toUpperCase(),": ",function(e){if(null==e)return"—";let l=Number(e);return Number.isNaN(l)?String(e):l.toLocaleString()}(t[e])]},e))})]})}function y(e){let{guildId:l,version:s}=e,[i,n]=(0,t.useState)(!0),[d,c]=(0,t.useState)(null),[o,u]=(0,t.useState)(null);return((0,t.useEffect)(()=>{let e=!1;return n(!0),c(null),(async()=>{try{let s=await (0,r.SC)("/api/guilds/".concat(l,"/snail/stats"));if(e)return;s.empty?u(null):u(s.record||null)}catch(l){e||c(l.message||"Failed to load stats")}finally{e||n(!1)}})(),()=>{e=!0}},[l,s]),i)?(0,a.jsx)("div",{className:"card",style:{padding:"1.25rem"},children:"Loading stats…"}):d?(0,a.jsx)("div",{className:"card",style:{padding:"1.25rem"},children:(0,a.jsx)("span",{style:{color:"#f87171"},children:d})}):o?(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:"1rem"},children:[(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"1rem",fontSize:"0.9rem"},children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Last run:"})," ",new Date(o.uploadedAt).toLocaleString()]}),o.prompt&&(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"Prompt:"})," ",o.prompt]})]}),(0,a.jsx)("div",{className:"grid",style:{gap:"1rem"},children:(o.results||[]).map(e=>{var l;return(0,a.jsx)(m,{result:e},null===(l=e.file)||void 0===l?void 0:l.storedAs)})})]}):(0,a.jsxs)("div",{className:"card",style:{padding:"1.25rem"},children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"No saved stats yet"}),(0,a.jsx)("p",{style:{margin:0,opacity:.8},children:"Run an analysis to generate your personal snail snapshot. It will appear here when complete."})]})}function g(e){let{guildId:l}=e,[s,i]=(0,t.useState)("active"),[n,d]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),[p,m]=(0,t.useState)(""),h=(0,t.useMemo)(()=>{var e;if(!n)return[];for(let l of[n.codes,n.data,null===(e=n.data)||void 0===e?void 0:e.codes,n.results,n.records])if(Array.isArray(l))return l;return[]},[n]);(0,t.useEffect)(()=>{let e=!1;return u(null),(async()=>{try{let a=await (0,r.SC)("/api/guilds/".concat(l,"/snail/codes?scope=").concat(s));e||d(a)}catch(l){e||u(l.message||"Failed to load codes")}})(),()=>{e=!0}},[l,s]);let y=(0,t.useCallback)(e=>{var l;e&&(null===(l=navigator.clipboard)||void 0===l||l.writeText(e).then(()=>{m("Copied ".concat(e)),setTimeout(()=>m(""),2e3)}))},[]);return(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:"1rem"},children:[(0,a.jsx)("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:o.map(e=>(0,a.jsx)("button",{className:"btn ".concat(s===e.value?"":"outline"),onClick:()=>i(e.value),children:e.label},e.value))}),p&&(0,a.jsx)("div",{style:{fontSize:"0.85rem",color:"#22c55e"},children:p}),c&&(0,a.jsx)("div",{style:{color:"#f87171"},children:c}),(0,a.jsx)("ul",{style:{listStyle:"none",margin:0,padding:0,display:"grid",gap:"0.75rem"},children:h.map(e=>(0,a.jsxs)("li",{className:"card",style:{padding:"0.9rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:600},children:e.code}),(0,a.jsx)("div",{style:{fontSize:"0.85rem",opacity:.75},children:e.description||e.desc||""})]}),(0,a.jsx)("button",{className:"btn outline",onClick:()=>y(e.code),children:"Copy"})]},e.code))}),!h.length&&!c&&(0,a.jsxs)("div",{style:{fontSize:"0.9rem",opacity:.75},children:["No codes for this scope. ",(null==n?void 0:n.source)==="local"?"Remote codes unavailable.":""]})]})}function x(e){let{guildId:l}=e,[s,i]=(0,t.useState)([]),[n,d]=(0,t.useState)(null);return(0,t.useEffect)(()=>{let e=!1;return(async()=>{try{let s=await (0,r.SC)("/api/guilds/".concat(l,"/snail/analyze_help"));e||i(Array.isArray(null==s?void 0:s.help)?s.help:[])}catch(l){e||d(l.message||"Failed to load help")}})(),()=>{e=!0}},[l]),(0,a.jsxs)("div",{className:"card",style:{padding:"1.25rem",display:"grid",gap:"0.75rem"},children:[(0,a.jsx)("h3",{style:{margin:0},children:"Snail Analyze Tips"}),n&&(0,a.jsx)("div",{style:{color:"#f87171"},children:n}),(0,a.jsx)("ul",{style:{margin:0,paddingLeft:"1.25rem",opacity:.85},children:s.map(e=>(0,a.jsx)("li",{children:e},e))})]})}function j(e){let{guildId:l}=e,[s,i]=(0,t.useState)(""),[n,d]=(0,t.useState)(""),[c,o]=(0,t.useState)(null),[u,p]=(0,t.useState)(null),m=(0,t.useCallback)(async()=>{p(null);try{let e=await (0,r.SC)("/api/guilds/".concat(l,"/snail/calc"),{method:"POST",body:{sim:s,total:n}});o(e)}catch(e){p(e.message||"Calc failed")}},[l,s,n]);return(0,a.jsxs)("div",{className:"card",style:{display:"grid",gap:"0.75rem",maxWidth:440},children:[(0,a.jsx)("input",{className:"input",value:s,inputMode:"numeric",placeholder:"SIM power",onChange:e=>i(e.target.value)}),(0,a.jsx)("input",{className:"input",value:n,inputMode:"numeric",placeholder:"Total power",onChange:e=>d(e.target.value)}),(0,a.jsx)("button",{className:"btn",onClick:m,children:"Calculate"}),u&&(0,a.jsx)("span",{style:{color:"#f87171"},children:u}),c&&(0,a.jsxs)("div",{style:{opacity:.85},children:["SIM: ",Number(c.sim||0).toLocaleString()," ",(0,a.jsx)("br",{}),"Total: ",Number(c.total||0).toLocaleString()," ",(0,a.jsx)("br",{}),"SIM %: ",(100*Number(c.simPct||0)).toFixed(2),"%"]})]})}function f(){return(0,a.jsxs)("div",{className:"card",style:{padding:"1.25rem"},children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"Snail Guides"}),(0,a.jsx)("p",{style:{margin:0,opacity:.8},children:"Our snail nerds are still working on this feature… it will be announced in Slime Chat when ready!"})]})}function v(){return(0,a.jsxs)("div",{className:"card",style:{padding:"1.25rem"},children:[(0,a.jsx)("h3",{style:{marginTop:0},children:"Species War Planner"}),(0,a.jsx)("p",{style:{margin:0,opacity:.8},children:"Coming soon. We're polishing the Slime Chat experience so you can plan wars with shortcuts, canned strategies, and replays."})]})}}},function(e){e.O(0,[898,754,888,774,179],function(){return e(e.s=4212)}),_N_E=e.O()}]);